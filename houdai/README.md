# Quest3 MR Defense Game

Quest3で動くMR（複合現実）ディフェンスゲーム。WebXRとThree.jsで作られている。

## 特徴

- Quest3のパススルーモードでプレイ可能
- VRコントローラーで操作
- 自動砲台がミサイルを迎撃
- 時間制限内に生き残ればクリア

## 必要なもの

- Meta Quest3
- PC（開発サーバー用）
- 同じネットワークに接続されたQuest3とPC

## セットアップ

### 1. 依存関係のインストール

```bash
# npm パッケージをインストール
npm install
```

### 2. mkcertのインストールと証明書の作成

WebXRはHTTPS環境が必要なので、mkcertで自己署名証明書を作成する。

```bash
# mkcertのインストール（macOS）
brew install mkcert

# mkcertの初期化（初回のみ、sudoパスワードが必要）
mkcert -install
```

vite-plugin-mkcertが自動で証明書を作成するので、追加の証明書作成は不要。

### 3. サーバーの起動

```bash
npm run dev
```

サーバーが起動したら、表示されるURLをメモする。
- ローカル: `https://localhost:5173`
- ネットワーク: `https://192.168.x.x:5173` (Quest3からアクセスする用)

### 4. Quest3からアクセス

1. Quest3のブラウザ（Meta Quest Browser）を開く
2. URLバーに `https://<PCのIPアドレス>:5173` を入力
3. 「MRモードに入る」ボタンをクリック
4. Quest3がMRモードに切り替わる

## 操作方法

### ゲーム開始前
- コントローラーのトリガーで「START」ボタンを押す

### ゲーム中
- 砲台が自動でミサイルを迎撃
- プレイヤーは見守るだけ（観察型ゲーム）
- シールド（HP）が0になるとゲームオーバー
- 制限時間（60秒）を生き残ればクリア

### ゲーム終了後
- コントローラーのトリガーで「RETRY」ボタンを押してリトライ

## ゲームの仕組み

- **砲台**: プレイヤーの前に配置され、自動で最も近いミサイルを狙って射撃する
- **ミサイル**: ランダムな方向から飛来し、砲台を狙う
- **弾**: 砲台が発射する弾で、ミサイルに当たると撃墜
- **難易度**: 時間経過と共にミサイルの出現率と速度が上昇

## トラブルシューティング

### Quest3でMRモードに入れない
- Quest3の設定で「パススルー」が有効になっているか確認
- ブラウザがHTTPSでアクセスしているか確認（URLが `https://` で始まる）

### 証明書エラーが出る
- mkcertで証明書を作成した際に、PCのローカルIPアドレスを含めたか確認
- Quest3とPCが同じWi-Fiネットワークに接続されているか確認

### コントローラーが反応しない
- Quest3のコントローラーが接続されているか確認
- MRモード内でコントローラーが表示されているか確認

## カスタマイズ

`index.html` を編集して以下をカスタマイズできる:

- `TIME_LIMIT`: ゲームの制限時間（秒）
- `TURRET_RANGE`: 砲台の射程範囲
- `MISSILE_SPEED_BASE`: ミサイルの基本速度
- `BULLET_SPEED`: 弾の速度

## 技術スタック

- Three.js 0.160.0
- WebXR API
- VRコントローラー入力
- パススルーMR

---

楽しんでくれ。
